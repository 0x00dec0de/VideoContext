var VideoContext=function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){E.push(e)}function a(e){void 0===x&&(x=e);for(var t=(e-x)/1e3,r=0;r<E.length;r++)E[r]._update(t);x=e,requestAnimationFrame(a)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(1),l=n(u),c=r(2),f=r(5),h=n(f),d=r(8),p=n(d),_=r(9),v=n(_),y=r(10),m=n(y),g=r(11),b=n(g),T=r(3),E=[],x=void 0;a();var O={playing:0,paused:1,stalled:2,ended:3,broken:4},R=function(){function e(t){i(this,e),this._canvas=t,this._gl=t.getContext("experimental-webgl",{preserveDrawingBuffer:!0,alpha:!1}),this._renderGraph=new b["default"],this._sourceNodes=[],this._processingNodes=[],this._timeline=[],this._currentTime=0,this._state=O.paused,this._playbackRate=1,this._destinationNode=new p["default"](this._gl,this._renderGraph),this._callbacks=new Map,this._callbacks.set("stalled",[]),this._callbacks.set("update",[]),this._callbacks.set("ended",[]),o(this)}return s(e,[{key:"registerCallback",value:function(e,t){return this._callbacks.has(e)?void this._callbacks.get(e).push(t):!1}},{key:"unregisterCallback",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=this._callbacks.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value,s=a.indexOf(e);if(-1!==s)return a.splice(s,1),!0}}catch(u){r=!0,n=u}finally{try{!t&&o["return"]&&o["return"]()}finally{if(r)throw n}}return!1}},{key:"_callCallbacks",value:function(e){var t=this._callbacks.get(e),r=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;s(this._currentTime)}}catch(u){n=!0,i=u}finally{try{!r&&a["return"]&&a["return"]()}finally{if(n)throw i}}}},{key:"play",value:function(){return console.debug("VideoContext - playing"),this._state=O.playing,!0}},{key:"pause",value:function(){return console.debug("VideoContext - pausing"),this._state=O.paused,!0}},{key:"createVideoSourceNode",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=new l["default"](e,this._gl,this._renderGraph,this._playbackRate,t);return this._sourceNodes.push(r),r}},{key:"createEffectNode",value:function(e){var t=new v["default"](this._gl,this._renderGraph,e);return this._processingNodes.push(t),t}},{key:"createCompositingNode",value:function(e){var t=new h["default"](this._gl,this._renderGraph,e);return this._processingNodes.push(t),t}},{key:"createTransitionNode",value:function(e){var t=new m["default"](this._gl,this._renderGraph,e);return this._processingNodes.push(t),t}},{key:"_isStalled",value:function(){for(var e=0;e<this._sourceNodes.length;e++){var t=this._sourceNodes[e];if(!t._isReady())return!0}return!1}},{key:"_update",value:function(e){if(this._state===O.playing||this._state===O.stalled||this._state===O.paused){this._callCallbacks("update"),this._state!==O.paused&&(this._isStalled()?(this._callCallbacks("stalled"),this._state=O.stalled):this._state=O.playing),this._state===O.playing&&(this._currentTime+=e*this._playbackRate,this._currentTime>this.duration&&(this._callCallbacks("ended"),this._state=O.ended));for(var t=0;t<this._sourceNodes.length;t++){var r=this._sourceNodes[t];r._update(this._currentTime),this._state===O.stalled&&r._isReady()&&r._state===c.SOURCENODESTATE.playing&&r._pause(),this._state===O.paused&&r._state===c.SOURCENODESTATE.playing&&r._pause(),this._state===O.playing&&r._state===c.SOURCENODESTATE.paused&&r._play()}var n=!0,i=!1,o=void 0;try{for(var a,s=this._processingNodes[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;u._update(this._currentTime),u._render()}}catch(l){i=!0,o=l}finally{try{!n&&s["return"]&&s["return"]()}finally{if(i)throw o}}this._destinationNode._render()}}},{key:"currentTime",set:function(e){console.debug("VideoContext - seeking to",e),e<this._duration&&this._state===O.ended&&(this._state=O.duration),("string"==typeof e||e instanceof String)&&(e=parseFloat(e));for(var t=0;t<this._sourceNodes.length;t++)this._sourceNodes[t]._seek(e);this._currentTime=e},get:function(){return this._currentTime}},{key:"duration",get:function(){for(var e=0,t=0;t<this._sourceNodes.length;t++)this._sourceNodes[t]._stopTime>e&&(e=this._sourceNodes[t]._stopTime);return e}},{key:"destination",get:function(){return this._destinationNode}},{key:"playbackRate",set:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=this._sourceNodes[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;"VideoNode"===a.constructor.name&&(a._playbackRate=e)}}catch(s){r=!0,n=s}finally{try{!t&&o["return"]&&o["return"]()}finally{if(r)throw n}}this._playbackRate=e},get:function(){return this._playbackRate}}]),e}();R.visualiseVideoContextTimeline=T.visualiseVideoContextTimeline,R.visualiseVideoContextGraph=T.visualiseVideoContextGraph,R.createControlFormForNode=T.createControlFormForNode,R.createSigmaGraphDataFromRenderGraph=T.createSigmaGraphDataFromRenderGraph,t["default"]=R,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,r=a,n=!0,s=l=void 0}},u=r(2),l=n(u),c=(r(3),function(e){function t(e,r,n){var o=(arguments.length<=3||void 0===arguments[3]?1:arguments[3],arguments.length<=4||void 0===arguments[4]?0:arguments[4]),a=arguments.length<=5||void 0===arguments[5]?4:arguments[5];i(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,r,n),this._preloadTime=a,this._sourceOffset=o,this._playbackRate=1}return o(t,e),a(t,[{key:"_load",value:function(){return void 0!==this._element?void(this._element.readyState>3&&!this._element.seeking?this._ready=!0:this._ready=!1):(this._isResponsibleForElementLifeCycle&&(s(Object.getPrototypeOf(t.prototype),"_load",this).call(this),this._element=document.createElement("video"),this._element.src=this._elementURL),void(this._element.currentTime=this._sourceOffset))}},{key:"_destroy",value:function(){s(Object.getPrototypeOf(t.prototype),"_destroy",this).call(this),this._isResponsibleForElementLifeCycle&&(this._element.src="",this._element=void 0,delete this._element),this._ready=!1}},{key:"_seek",value:function(e){if(s(Object.getPrototypeOf(t.prototype),"_seek",this).call(this,e),this.state===u.SOURCENODESTATE.playing||this.state===u.SOURCENODESTATE.paused){void 0===this._element&&this._load();var r=this._currentTime-this._startTime+this._sourceOffset;this._element.currentTime=r,this._ready=!1}this._state!==u.SOURCENODESTATE.sequenced&&this._state!==u.SOURCENODESTATE.ended||void 0===this._element||this._destroy()}},{key:"_update",value:function(e){s(Object.getPrototypeOf(t.prototype),"_update",this).call(this,e);return this._startTime-this._currentTime<this._preloadTime&&this._state!==u.SOURCENODESTATE.waiting&&this._state!==u.SOURCENODESTATE.ended&&this._load(),this._state===u.SOURCENODESTATE.playing?(this._element.playbackRate=this._playbackRate,this._element.play(),!0):this._state===u.SOURCENODESTATE.paused?(this._element.pause(),!0):this._state===u.SOURCENODESTATE.ended&&void 0!==this._element?(this._element.pause(),this._destroy(),!1):void 0}}]),t}(l["default"]));t["default"]=c,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,r=a,n=!0,s=l=void 0}},u=r(3),l=r(4),c=n(l),f={waiting:0,sequenced:1,playing:2,paused:3,ended:4},h=function(e){function t(e,r,n){i(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,r,n,0),this._element=void 0,this._elementURL=void 0,this._isResponsibleForElementLifeCycle=!0,"string"==typeof e?this._elementURL=e:(this._element=e,this._isResponsibleForElementLifeCycle=!1),this._state=f.waiting,this._currentTime=0,this._startTime=0,this._stopTime=0,this._ready=!1,this._texture=(0,u.createElementTexutre)(r),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array([0,0,0,0])),this._callbacks=[]}return o(t,e),a(t,[{key:"_load",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this._callbacks[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;"load"===o.type&&o.func(this)}}catch(a){t=!0,r=a}finally{try{!e&&i["return"]&&i["return"]()}finally{if(t)throw r}}}},{key:"_destroy",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this._callbacks[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;"destroy"===o.type&&o.func(this)}}catch(a){t=!0,r=a}finally{try{!e&&i["return"]&&i["return"]()}finally{if(t)throw r}}}},{key:"attachCallback",value:function(e,t){this._callbacks.push({type:e,func:t})}},{key:"removeCallback",value:function(e){var t=[],r=!0,n=!1,i=void 0;try{for(var o,a=this._callbacks[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;s.func===e&&t.push(s)}}catch(u){n=!0,i=u}finally{try{!r&&a["return"]&&a["return"]()}finally{if(n)throw i}}var l=!0,c=!1,f=void 0;try{for(var h,d=t[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var s=h.value,p=this._callbacks.indexOf(s);this._callbacks.splice(p,1)}}catch(u){c=!0,f=u}finally{try{!l&&d["return"]&&d["return"]()}finally{if(c)throw f}}}},{key:"start",value:function(e){return this._state!==f.waiting?(console.debug("SourceNode is has already been sequenced. Can't sequence twice."),!1):(this._startTime=this._currentTime+e,this._state=f.sequenced,!0)}},{key:"stop",value:function(e){return this._state===f.ended?(console.debug("SourceNode has already ended. Cannot call stop."),!1):this._state===f.waiting?(console.debug("SourceNode must have start called before stop is called"),!1):this._currentTime+e<=this._startTime?(console.debug("SourceNode must have a stop time after it's start time, not before."),!1):(this._stopTime=this._currentTime+e,!0)}},{key:"_seek",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=this._callbacks[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;"seek"===a.type&&a.func(this,e)}}catch(s){r=!0,n=s}finally{try{!t&&o["return"]&&o["return"]()}finally{if(r)throw n}}this._state!==f.waiting&&(e<this._startTime&&((0,u.clearTexture)(this._gl,this._texture),this._state=f.sequenced),e>=this._startTime&&this._state!==f.paused&&(this._state=f.playing),e>=this._stopTime&&((0,u.clearTexture)(this._gl,this._texture),this._state=f.ended),this._currentTime=e)}},{key:"_pause",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this._callbacks[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;"pause"===o.type&&o.func(this)}}catch(a){t=!0,r=a}finally{try{!e&&i["return"]&&i["return"]()}finally{if(t)throw r}}this._state===f.playing&&(this._state=f.paused)}},{key:"_play",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this._callbacks[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;"play"===o.type&&o.func(this)}}catch(a){t=!0,r=a}finally{try{!e&&i["return"]&&i["return"]()}finally{if(t)throw r}}this._state===f.paused&&(this._state=f.playing)}},{key:"_isReady",value:function(){return this._state===f.playing||this._state===f.paused?this._ready:!0}},{key:"_update",value:function(e){if(this._rendered=!0,this._state===f.waiting||this._state===f.ended)return!1;var t=!0,r=!1,n=void 0;try{for(var i,o=this._callbacks[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;"render"===a.type&&a.func(this,e)}}catch(s){r=!0,n=s}finally{try{!t&&o["return"]&&o["return"]()}finally{if(r)throw n}}return e<this._startTime&&((0,u.clearTexture)(this._gl,this._texture),this._state=f.sequenced),e>=this._startTime&&this._state!==f.paused&&(this._state=f.playing),e>=this._stopTime&&((0,u.clearTexture)(this._gl,this._texture),this._state=f.ended),this._currentTime=e,void 0===this._element||this._ready===!1?!0:(this._state===f.playing&&(0,u.updateTexture)(this._gl,this._texture,this._element),!0)}},{key:"clearTimelineState",value:function(){this._startTime=0,this._stopTime=0,this._state=f.waiting}},{key:"state",get:function(){return this._state}}]),t}(c["default"]);t["default"]=h,t.SOURCENODESTATE=f},function(e,t){"use strict";function r(e,t,r){var n=e.createShader(r);e.shaderSource(n,t),e.compileShader(n);var i=e.getShaderParameter(n,e.COMPILE_STATUS);if(!i)throw"could not compile shader:"+e.getShaderInfoLog(n);return n}function n(e,t,n){var i=r(e,t,e.VERTEX_SHADER),o=r(e,n,e.FRAGMENT_SHADER),a=e.createProgram();if(e.attachShader(a,i),e.attachShader(a,o),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw{error:4,msg:"Can't link shader program for track",toString:function(){return this.msg}};return a}function i(e){var t=(arguments.length<=1||void 0===arguments[1]?new Uint8Array([0,0,0,0]):arguments[1],arguments.length<=2||void 0===arguments[2]?1:arguments[2],arguments.length<=3||void 0===arguments[3]?1:arguments[3],e.createTexture());return e.bindTexture(e.TEXTURE_2D,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),t}function o(e,t,r){e.bindTexture(e.TEXTURE_2D,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}function a(e,t){e.bindTexture(e.TEXTURE_2D,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([0,0,0,0]))}function s(e,t){var r=document.createElement("div");if(void 0!==t){var n=document.createElement("h2");n.innerHTML=t,r.appendChild(n)}var i=function(t){var n=document.createElement("p"),i=document.createElement("h3");i.innerHTML=t,n.appendChild(i);var o=e._properties[t].value;if("number"==typeof o)!function(){var r=document.createElement("input");r.setAttribute("type","range"),r.setAttribute("min","0"),r.setAttribute("max","1"),r.setAttribute("value",o,toString());var i=!1;r.onmousedown=function(){i=!0},r.onmouseup=function(){i=!1},r.onmousemove=function(){i&&(e[t]=parseFloat(r.value))},r.onchange=function(){e[t]=parseFloat(r.value)},n.appendChild(r)}();else if("[object Array]"===Object.prototype.toString.call(o)){var s=function(){var r=document.createElement("input");r.setAttribute("type","range"),r.setAttribute("min","0"),r.setAttribute("max","1"),r.setAttribute("step","0.01"),r.setAttribute("value",o[a],toString());var i=a,s=!1;r.onmousedown=function(){s=!0},r.onmouseup=function(){s=!1},r.onmousemove=function(){s&&(e[t][i]=parseFloat(r.value))},r.onchange=function(){e[t][i]=parseFloat(r.value)},n.appendChild(r)};for(a=0;a<o.length;a++)s()}r.appendChild(n)};for(var o in e._properties){var a;i(o)}return r}function u(e,t){function r(e){for(var t=0;t<a.length;t++)if(a[t].node===e)return a[t];return void 0}var n=t.getContext("2d"),i=t.width,o=t.height,a=[];n.clearRect(0,0,i,o);var s=o/e._sourceNodes.length/2,u=1.618*s,l={w:u,h:s,y:o/2-s/2,x:i-u,node:e.destination,color:"#7D9F35"};a.push(l);for(var c=0;c<e._sourceNodes.length;c++){var f=e._sourceNodes[c],h=0,d=c*(o/e._sourceNodes.length),p={w:u,h:s,x:h,y:d,node:f,color:"#572A72"};a.push(p)}for(var c=0;c<e._processingNodes.length;c++){var f=e._processingNodes[c],_="#AA9639";"CompositingNode"===f.constructor.name&&(_="#000000");var h=Math.random()*(i-4*u)+2*u,d=Math.random()*(o-2*s)+s,p={w:u,h:s,x:h,y:d,node:f,color:_};a.push(p)}for(var c=0;c<e._renderGraph.connections.length;c++){var v=e._renderGraph.connections[c],y=r(v.source),m=r(v.destination);void 0!==y&&void 0!==m&&(n.moveTo(y.x+u/2,y.y+s/2),n.lineTo(m.x+u/2,m.y+s/2),n.stroke())}for(var c=0;c<a.length;c++){var g=a[c];n.fillStyle=g.color,n.fillRect(g.x,g.y,g.w,g.h),n.fill()}}function l(e){function t(t){if(-1!==e._sourceNodes.indexOf(t)){var r=t.constructor.name+" "+e._sourceNodes.indexOf(t);return r}var n=t.constructor.name+" "+e._processingNodes.indexOf(t);return n}for(var r={nodes:[{id:t(e.destination),label:"Destination Node",x:2.5,y:.5,size:2,node:e.destination}],edges:[]},n=0;n<e._sourceNodes.length;n++){var i=e._sourceNodes[n],o=n*(1/e._sourceNodes.length);r.nodes.push({id:t(i),label:"Source "+n.toString(),x:0,y:o,size:2,color:"#572A72",node:i})}for(var n=0;n<e._processingNodes.length;n++){var a=e._processingNodes[n];r.nodes.push({id:t(a),x:2.5*Math.random(),y:Math.random(),size:2,node:a})}for(var n=0;n<e._renderGraph.connections.length;n++){var s=e._renderGraph.connections[n];r.edges.push({id:"e"+n.toString(),source:t(s.source),target:t(s.destination)})}return r}function c(e,t,r){var n=t.getContext("2d"),i=t.width,o=t.height,a=o/e._sourceNodes.length,s=e.duration,u=i/s,l={video:["#572A72","#3C1255"],image:["#7D9F35","#577714"],canvas:["#AA9639","#806D15"]};n.clearRect(0,0,i,o),n.fillStyle="#999";var c=!0,f=!1,h=void 0;try{for(var d,p=e._processingNodes[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var _=d.value;if("TransitionNode"===_.constructor.name)for(var v in _._transitions){var y=!0,m=!1,g=void 0;try{for(var b,T=_._transitions[v][Symbol.iterator]();!(y=(b=T.next()).done);y=!0){var E=b.value,x=(E.end-E.start)*u,O=o,R=E.start*u,S=0;n.fillStyle="rgba(0,0,0, 0.3)",n.fillRect(R,S,x,O),n.fill()}}catch(w){m=!0,g=w}finally{try{!y&&T["return"]&&T["return"]()}finally{if(m)throw g}}}}}catch(w){f=!0,h=w}finally{try{!c&&p["return"]&&p["return"]()}finally{if(f)throw h}}for(var k=0;k<e._sourceNodes.length;k++){var A=e._sourceNodes[k],N=A._stopTime-A._startTime,C=A._startTime,U=N*u,F=a,P=C*u,j=a*k;n.fillStyle=l.video[k%l.video.length],n.fillRect(P,j,U,F),n.fill()}void 0!==r&&(n.fillStyle="#000",n.fillRect(r*u,0,1,o))}Object.defineProperty(t,"__esModule",{value:!0}),t.compileShader=r,t.createShaderProgram=n,t.createElementTexutre=i,t.updateTexture=o,t.clearTexture=a,t.createControlFormForNode=s,t.visualiseVideoContextGraph=u,t.createSigmaGraphDataFromRenderGraph=l,t.visualiseVideoContextTimeline=c},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(t,n,i){r(this,e),this._renderGraph=n,this._maxInputs=i,this._gl=t,this._renderGraph=n,this._rendered=!1}return n(e,[{key:"connect",value:function(e,t){if(void 0===t){var r=this._renderGraph.getSortedInputsForNode(e);t=r[r.length-1]+1}return this._renderGraph.registerConnection(this,e,t)}},{key:"disconnect",value:function(e){if(void 0===e){var t=this._renderGraph.getOutputsForNode(this);return t.forEach(function(e){this._renderGraph.unregisterConnection(this,e)}),t.length>0?!0:!1}return this._renderGraph.unregisterConnection(this,e)}},{key:"inputs",get:function(){var e=this._renderGraph.getSortedInputsForNode(this),t=[];return e.forEach(function(e){t.push(e.node)}),t}},{key:"outputs",get:function(){var e=this._renderGraph.getSortedOutputsForNode(this),t=[];return e.forEach(function(e){t.push(e.node)}),t}}]),e}();t["default"]=i,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,r=a,n=!0,s=l=void 0}},u=r(6),l=n(u),c=r(3),f=function(e){function t(e,r,n){i(this,t);var o=(0,c.createElementTexutre)(e);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([0,0,0,0])),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,r,n),this._placeholderTexture=o}return o(t,e),a(t,[{key:"_render",value:function(){var e=this,r=this._gl,n=this;r.bindFramebuffer(r.FRAMEBUFFER,this._framebuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this._texture,0),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),this.inputs.forEach(function(i){s(Object.getPrototypeOf(t.prototype),"_render",e).call(e);var o=i._texture,a=0,u=!0,l=!1,c=void 0;try{for(var f,h=n._inputTextureUnitMapping[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var d=f.value;r.activeTexture(d.textureUnit);var p=r.getUniformLocation(n._program,d.name);r.uniform1i(p,n._parameterTextureCount+a),a+=1,r.bindTexture(r.TEXTURE_2D,o)}}catch(_){l=!0,c=_}finally{try{!u&&h["return"]&&h["return"]()}finally{if(l)throw c}}r.drawArrays(r.TRIANGLES,0,6)}),r.bindFramebuffer(r.FRAMEBUFFER,null)}}]),t}(l["default"]);t["default"]=f,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,r=a,n=!0,s=l=void 0}},u=r(4),l=n(u),c=r(3),f=r(7),h=function(e){function t(e,r,n,o){var a=this;i(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,r,o),this._vertexShader=n.vertexShader,this._fragmentShader=n.fragmentShader,this._properties={};for(var u in n.properties){var l=n.properties[u].value;"[object Array]"===Object.prototype.toString.call(l)&&(l=n.properties[u].value.slice());var h=n.properties[u].type;this._properties[u]={type:h,value:l}}this._inputTextureUnitMapping=[],this._maxTextureUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this._boundTextureUnits=0,this._parameterTextureCount=0,this._inputTextureCount=0,this._texture=(0,c.createElementTexutre)(e,null,e.canvas.width,e.canvas.height),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.canvas.width,e.canvas.height,0,e.RGBA,e.UNSIGNED_BYTE,null),this._program=(0,c.createShaderProgram)(e,this._vertexShader,this._fragmentShader),this._framebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._texture,0),e.bindFramebuffer(e.FRAMEBUFFER,null);var d=function(e){Object.defineProperty(a,e,{get:function(){return this._properties[e].value},set:function(t){this._properties[e].value=t}})};for(var u in this._properties)d(u);for(var u in this._properties){var l=this._properties[u].value;if(l instanceof Image&&(this._properties[u].texture=(0,c.createElementTexutre)(e),this._properties[u].texutreUnit=e.TEXTURE0+this._boundTextureUnits,this._boundTextureUnits+=1,this._parameterTextureCount+=1,this._boundTextureUnits>this._maxTextureUnits))throw new f.RenderException("Trying to bind more than available textures units to shader")}var p=!0,_=!1,v=void 0;try{for(var y,m=n.inputs[Symbol.iterator]();!(p=(y=m.next()).done);p=!0){var g=y.value;if(this._inputTextureUnitMapping.push({name:g,textureUnit:e.TEXTURE0+this._boundTextureUnits}),this._boundTextureUnits+=1,this._inputTextureCount+=1,this._boundTextureUnits>this._maxTextureUnits)throw new f.RenderException("Trying to bind more than available textures units to shader")}}catch(b){_=!0,v=b}finally{try{!p&&m["return"]&&m["return"]()}finally{if(_)throw v}}for(var u in this._properties)"uniform"===this._properties[u].type&&(this._properties[u].location=this._gl.getUniformLocation(this._program,u));this._currentTimeLocation=this._gl.getUniformLocation(this._program,"currentTime"),this._currentTime=0;var T=e.getAttribLocation(this._program,"a_position"),E=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,E),e.enableVertexAttribArray(T),e.vertexAttribPointer(T,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,1,0,0,1,0,0]),e.STATIC_DRAW);var x=e.getAttribLocation(this._program,"a_texCoord");e.enableVertexAttribArray(x),e.vertexAttribPointer(x,2,e.FLOAT,!1,0,0)}return o(t,e),a(t,[{key:"_update",value:function(e){this._currentTime=e}},{key:"_render",value:function(){this._rendered=!0;var e=this._gl;e.viewport(0,0,e.canvas.width,e.canvas.height),e.useProgram(this._program);var t=0;for(var r in this._properties){var n=this._properties[r].value,i=this._properties[r].type,o=this._properties[r].location;if("uniform"===i)if("number"==typeof n)e.uniform1f(o,n);else if("[object Array]"===Object.prototype.toString.call(n))1===n.length?e.uniform1fv(o,n):2===n.length?e.uniform2fv(o,n):3===n.length?e.uniform3fv(o,n):4===n.length?e.uniform4fv(o,n):console.debug("Shader parameter",r,"is too long an array:",n);else if(n instanceof Image){var a=this._properties[r].texture,s=this._properties[r].texutreUnit;(0,c.updateTexture)(e,a,n),e.activeTexture(s),e.uniform1i(o,t),t+=1,e.bindTexture(e.TEXTURE_2D,a)}}}}]),t}(l["default"]);t["default"]=h,e.exports=t["default"]},function(e,t){"use strict";function r(e){this.message=e,this.name="ConnectionException"}function n(e){this.message=e,this.name="RenderException"}Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectException=r,t.RenderException=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,r=a,n=!0,s=l=void 0}},u=(r(2),r(6)),l=n(u),c=function(e){function t(e,r){i(this,t);var n="	            attribute vec2 a_position;	            attribute vec2 a_texCoord;	            varying vec2 v_texCoord;	            void main() {	                gl_Position = vec4(vec2(2.0,2.0)*a_position-vec2(1.0, 1.0), 0.0, 1.0);	                v_texCoord = a_texCoord;	            }",o="	            precision mediump float;	            uniform sampler2D u_image;	            varying vec2 v_texCoord;	            varying float v_progress;	            void main(){	                gl_FragColor = texture2D(u_image, v_texCoord);	            }";s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,r,{fragmentShader:o,vertexShader:n,properties:{},inputs:["u_image"]})}return o(t,e),a(t,[{key:"_render",value:function(){var e=this,r=this._gl,n=this;r.bindFramebuffer(r.FRAMEBUFFER,null),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.enable(r.BLEND),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),this.inputs.forEach(function(i){s(Object.getPrototypeOf(t.prototype),"_render",e).call(e);var o=i._texture,a=0,u=!0,l=!1,c=void 0;try{for(var f,h=n._inputTextureUnitMapping[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var d=f.value;r.activeTexture(d.textureUnit);var p=r.getUniformLocation(n._program,d.name);r.uniform1i(p,n._parameterTextureCount+a),a+=1,r.bindTexture(r.TEXTURE_2D,o)}}catch(_){l=!0,c=_}finally{try{!u&&h["return"]&&h["return"]()}finally{if(l)throw c}}r.drawArrays(r.TRIANGLES,0,6)})}}]),t}(l["default"]);t["default"]=c,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,
n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,r=a,n=!0,s=l=void 0}},u=r(6),l=n(u),c=r(3),f=function(e){function t(e,r,n){i(this,t);var o=n.inputs.length,a=(0,c.createElementTexutre)(e);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([0,0,0,0])),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,r,n,o),this._placeholderTexture=a}return o(t,e),a(t,[{key:"_render",value:function(){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._texture,0),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),s(Object.getPrototypeOf(t.prototype),"_render",this).call(this);for(var r=this.inputs,n=0,i=0;i<this._inputTextureUnitMapping.length;i++){var o=this._placeholderTexture,a=this._inputTextureUnitMapping[i].textureUnit,u=this._inputTextureUnitMapping[i].name;i<r.length&&(o=r[i]._texture),e.activeTexture(a);var l=e.getUniformLocation(this._program,u);e.uniform1i(l,this._parameterTextureCount+n),n+=1,e.bindTexture(e.TEXTURE_2D,o)}e.drawArrays(e.TRIANGLES,0,6),e.bindFramebuffer(e.FRAMEBUFFER,null)}}]),t}(l["default"]);t["default"]=f,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,r=a,n=!0,s=l=void 0}},u=r(9),l=n(u),c=function(e){function t(e,r,n){i(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,r,n),this._transitions={},this._initialPropertyValues={};for(var o in this._properties)this._initialPropertyValues[o]=this._properties[o].value}return o(t,e),a(t,[{key:"_doesTransitionFitOnTimeline",value:function(e){if(void 0===this._transitions[e.property])return!0;var t=!0,r=!1,n=void 0;try{for(var i,o=this._transitions[e.property][Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(e.start>a.start&&e.start<a.end)return!1;if(e.end>a.start&&e.end<a.end)return!1;if(a.start>e.start&&a.start<e.end)return!1;if(a.end>e.start&&a.end<e.end)return!1}}catch(s){r=!0,n=s}finally{try{!t&&o["return"]&&o["return"]()}finally{if(r)throw n}}return!0}},{key:"_insertTransitionInTimeline",value:function(e){void 0===this._transitions[e.property]&&(this._transitions[e.property]=[]),this._transitions[e.property].push(e),this._transitions[e.property].sort(function(e,t){return e.start-t.start})}},{key:"transition",value:function r(e,t,n){var i=arguments.length<=3||void 0===arguments[3]?"progress":arguments[3],r={start:e+this._currentTime,end:t+this._currentTime,target:n,property:i};return this._doesTransitionFitOnTimeline(r)?void this._insertTransitionInTimeline(r):!1}},{key:"clearTransitions",value:function(e){void 0===e?this._transitions={}:this._transitions[e]=[]}},{key:"_update",value:function(e){s(Object.getPrototypeOf(t.prototype),"_update",this).call(this,e);for(var r in this._transitions){for(var n=this._initialPropertyValues[r],i=!1,o=0;o<this._transitions[r].length;o++){var a=this._transitions[r][o];if(e>a.end)n=a.target;else if(e>a.start&&e<a.end){var u=a.target-n,l=(this._currentTime-a.start)/(a.end-a.start);i=!0,this[r]=n+u*l;break}}i||(this[r]=n)}}}]),t}(l["default"]);t["default"]=c,e.exports=t["default"]},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(7),a=function(){function e(){n(this,e),this.connections=[]}return i(e,[{key:"getOutputsForNode",value:function(e){var t=[];return this.connections.forEach(function(r){r.source===e&&t.push({node:r.destination,zIndex:r.zIndex})}),t}},{key:"getSortedOutputsForNode",value:function(e){var t=this.getOutputsForNode(e);return t.sort(function(e,t){return e.zIndex-t.zIndex}),t}},{key:"getInputsForNode",value:function(e){var t=[];return this.connections.forEach(function(r){r.destination===e&&t.push({node:r.source,zIndex:r.zIndex})}),t}},{key:"getSortedInputsForNode",value:function(e){var t=this.getInputsForNode(e);return t.sort(function(e,t){return e.zIndex-t.zIndex}),t}},{key:"registerConnection",value:function(e,t,r){if(void 0!==t._maxInputs&&t.inputs.length>=t._maxInputs)throw new o.ConnectException("Node has reached max number of inputs, can't connect");return this.connections.push({source:e,zIndex:r,destination:t}),!0}},{key:"unregsiterConnection",value:function(e,t){var r=[];return this.connections.forEach(function(n){n.source===e&&n.destination===t&&r.push(n)}),0===r.length?!1:(this.toRemove.forEach(function(e){var t=this.connections.indexOf(e);this.connections.splice(t,1)}),!0)}}]),e}();t["default"]=a,e.exports=t["default"]}]);
